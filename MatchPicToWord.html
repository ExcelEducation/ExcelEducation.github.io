<!DOCTYPE html>
<html>
<head>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<!-- MooTools library -->
	<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.4.5/mootools-yui-compressed.js"></script>
	
    <style>
		#controllers {
		  width: 600px;
		  font-size: 0.8em;
		  color: #333;
		}
		#paint {
		  border: 1px solid #000;
		  background: #fff;
		}
    </style>
</head>	
<body>

	<div class="container">
		<h1>Draw a line connecting image to the correct word</h1>
		<p>User the mouse to draw over the canvas. Use the buttons to undo, redo or clear what you draw.</p>
		<div id="controllers" style="padding: 1rem 0rem":>
		  <button id="undo" type="button" class="btn btn-outline-primary">undo</button>
		  <button id="redo" type="button" class="btn btn-outline-primary">redo</button>
		  <button id="pencil" type="button" class="btn btn-outline-primary" style="display: none;">pencil</button>
		  <button id="clear" type="button" class="btn btn-outline-primary">clear</button>
		</div>
		<canvas width="420" height="630" id="paint" style="background: url('MatchPicToWord.jpg'); background-repeat:no-repeat;"></canvas> 
	</div>
	
	<script type="text/javascript">
		(function($) {
		  var tool;
		  var canvas = $('paint');
		  var ctx = canvas.getContext('2d');
		  
		  var history = {
			redo_list: [],
			undo_list: [],
			saveState: function(canvas, list, keep_redo) {
			  keep_redo = keep_redo || false;
			  if(!keep_redo) {
				this.redo_list = [];
			  }
			  
			  (list || this.undo_list).push(canvas.toDataURL());   
			},
			undo: function(canvas, ctx) {
			  this.restoreState(canvas, ctx, this.undo_list, this.redo_list);
			},
			redo: function(canvas, ctx) {
			  this.restoreState(canvas, ctx, this.redo_list, this.undo_list);
			},
			restoreState: function(canvas, ctx,  pop, push) {
			  if(pop.length) {
				this.saveState(canvas, push, true);
				var restore_state = pop.pop();
				var img = new Element('img', {'src':restore_state});
				img.onload = function() {
				  ctx.clearRect(0, 0, canvas.width, canvas.height);
				  ctx.drawImage(img, 0, 0, canvas.width, canvas.height, 0, 0, canvas.width, canvas.height);  
				}
			  }
			}
		  }
		  
		  var pencil = {
			options: {
			  stroke_color: ['00', '00', '00'],
			  dim: 4
			},
			init: function(canvas, ctx) {
			  this.canvas = canvas;
			  this.canvas_coords = this.canvas.getCoordinates();
			  this.ctx = ctx;
			  this.ctx.strokeColor = this.options.stroke_color;
			  this.drawing = false;
			  this.addCanvasEvents();
			},
			addCanvasEvents: function() {
			  this.canvas.addEvent('mousedown', this.start.bind(this));
			  this.canvas.addEvent('mousemove', this.stroke.bind(this));
			  this.canvas.addEvent('mouseup', this.stop.bind(this));
			  this.canvas.addEvent('mouseout', this.stop.bind(this));
			},
			start: function(evt) {
			  var x = evt.page.x - this.canvas_coords.left;
			  var y = evt.page.y - this.canvas_coords.top;
			  this.ctx.beginPath();
			  this.ctx.moveTo(x, y);
			  history.saveState(this.canvas);
			  this.drawing = true;
			},
			stroke: function(evt) {
			  if(this.drawing) {
				var x = evt.page.x - this.canvas_coords.left;
				var y = evt.page.y - this.canvas_coords.top;
				this.ctx.lineTo(x, y);
				this.ctx.stroke();
				
			  }
			},
			stop: function(evt) {
			  if(this.drawing) this.drawing = false;
			}
		  };
		  
		  var clear = {
			init: function(canvas, ctx) {
			  ctx.clearRect(0, 0, canvas.width, canvas.height);
			}
		  };		  
		  
		  $('pencil').addEvent('click', function() {
			pencil.init(canvas, ctx);
		  });
		  
		  $('undo').addEvent('click', function() {
			history.undo(canvas, ctx);
		  });
		  
		  $('redo').addEvent('click', function() {
			history.redo(canvas, ctx);
		  });
		  
		  $('clear').addEvent('click', function() {
			clear.init(canvas, ctx);
		  });		  
		  
		})(document.id)
		
		// Trigger pencil on load
		window.onload = function() {
  		  $("#pencil").click();
 		};
    </script>		 
	
</body>
</html>